# OpenAPI Schema: Sessions Endpoints

**Purpose**: Documented API contract for session management endpoints  
**Format**: OpenAPI 3.0.0 (machine-readable schema)  
**Status**: Specification (to be generated via Swashbuckle in implementation)

## Overview

This document defines the API contract for endpoints related to session management. The actual OpenAPI JSON/YAML will be auto-generated by Swashbuckle during build.

---

## Endpoints

### GET /api/sessions/{sessionId}

**Summary**: Retrieve a specific session and its metadata

**Parameters**:
- `sessionId` (path, required, string): UUID of the session to retrieve

**Security**: Requires JWT Bearer token (Authorization header)

**Responses**:

| Status | Description | Schema |
|--------|-------------|--------|
| 200 | Session retrieved successfully | Session |
| 400 | Invalid session ID format | ValidationResult |
| 401 | Missing or invalid authentication token | ValidationResult |
| 404 | Session not found or user lacks access | ValidationResult |
| 500 | Server error | ValidationResult |

**Example Request**:
```
GET /api/sessions/550e8400-e29b-41d4-a716-446655440000
Authorization: Bearer {jwt_token}
```

**Example Response (200)**:
```json
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
  "status": "draft",
  "startedAt": "2026-02-10T10:30:00Z",
  "lastActivityAt": "2026-02-10T14:22:15Z",
  "createdAt": "2026-02-10T10:30:00Z",
  "updatedAt": "2026-02-10T14:22:15Z",
  "metadata": {}
}
```

**Example Response (404)**:
```json
{
  "isValid": false,
  "code": "SESSION_NOT_FOUND",
  "message": "Session 550e8400-e29b-41d4-a716-446655440000 not found or you lack access",
  "errors": []
}
```

---

### POST /api/sessions

**Summary**: Create a new session

**Request Body**:
- `userId` (string, required, UUID): User creating the session
- `initialData` (object, optional): Initial session data

**Security**: Requires JWT Bearer token

**Responses**:

| Status | Description | Schema |
|--------|-------------|--------|
| 201 | Session created successfully | Session |
| 400 | Invalid request body | ValidationResult |
| 401 | Unauthorized | ValidationResult |
| 500 | Server error | ValidationResult |

**Example Request**:
```
POST /api/sessions
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "userId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
  "initialData": null
}
```

**Example Response (201)**:
```json
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
  "status": "draft",
  "startedAt": "2026-02-10T10:30:00Z",
  "lastActivityAt": "2026-02-10T10:30:00Z",
  "createdAt": "2026-02-10T10:30:00Z",
  "updatedAt": "2026-02-10T10:30:00Z",
  "metadata": {}
}
```

---

### POST /api/sessions/{sessionId}/answers

**Summary**: Add or update an answer to a question in a session

**Path Parameters**:
- `sessionId` (string, required, UUID): Session to add answer to

**Request Body**:
- `questionId` (string, required): Question identifier
- `answerValue` (string/number/object, required): User's response
- `dataType` (enum, required): "string", "number", "date", "boolean", or "object"

**Security**: Requires JWT Bearer token

**Responses**:

| Status | Description | Schema |
|--------|-------------|--------|
| 200 | Answer saved successfully | SessionAnswer |
| 400 | Invalid request body or validation failed | ValidationResult |
| 401 | Unauthorized | ValidationResult |
| 404 | Session not found | ValidationResult |
| 500 | Server error | ValidationResult |

**Example Request**:
```
POST /api/sessions/550e8400-e29b-41d4-a716-446655440000/answers
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "questionId": "annual_income",
  "answerValue": 45000,
  "dataType": "number"
}
```

**Example Response (200)**:
```json
{
  "answerId": "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6",
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "questionId": "annual_income",
  "answerValue": 45000,
  "dataType": "number",
  "createdAt": "2026-02-10T10:32:00Z",
  "updatedAt": "2026-02-10T10:32:00Z"
}
```

**Example Response (400)**:
```json
{
  "isValid": false,
  "code": "VALIDATION_ERROR",
  "message": "Validation failed. See errors for details.",
  "errors": [
    {
      "field": "answerValue",
      "message": "Annual income must be a non-negative number"
    }
  ]
}
```

---

### GET /api/sessions/{sessionId}/answers

**Summary**: Retrieve all answers for a session

**Path Parameters**:
- `sessionId` (string, required, UUID): Session to retrieve answers for

**Query Parameters**:
- `questionId` (string, optional): Filter answers by specific question ID
- `skip` (integer, optional): Number of records to skip (default: 0)
- `take` (integer, optional): Number of records to return (default: 100, max: 1000)

**Security**: Requires JWT Bearer token

**Responses**:

| Status | Description | Schema |
|--------|-------------|--------|
| 200 | Answers retrieved successfully | Array of SessionAnswer |
| 400 | Invalid query parameters | ValidationResult |
| 401 | Unauthorized | ValidationResult |
| 404 | Session not found | ValidationResult |
| 500 | Server error | ValidationResult |

**Example Request**:
```
GET /api/sessions/550e8400-e29b-41d4-a716-446655440000/answers?skip=0&take=50
Authorization: Bearer {jwt_token}
```

**Example Response (200)**:
```json
[
  {
    "answerId": "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6",
    "sessionId": "550e8400-e29b-41d4-a716-446655440000",
    "questionId": "annual_income",
    "answerValue": 45000,
    "dataType": "number",
    "createdAt": "2026-02-10T10:32:00Z",
    "updatedAt": "2026-02-10T10:32:00Z"
  },
  {
    "answerId": "b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7",
    "sessionId": "550e8400-e29b-41d4-a716-446655440000",
    "questionId": "num_dependents",
    "answerValue": 2,
    "dataType": "number",
    "createdAt": "2026-02-10T10:33:00Z",
    "updatedAt": "2026-02-10T10:33:00Z"
  }
]
```

---

### GET /api/sessions/{sessionId}/export

**Summary**: Export complete session data including answers and metadata

**Path Parameters**:
- `sessionId` (string, required, UUID): Session to export

**Query Parameters**:
- `format` (enum, optional): "json" (default) or "csv"

**Security**: Requires JWT Bearer token

**Responses**:

| Status | Description | Schema |
|--------|-------------|--------|
| 200 | Session exported successfully | SessionData |
| 401 | Unauthorized | ValidationResult |
| 404 | Session not found | ValidationResult |
| 500 | Server error | ValidationResult |

**Example Request**:
```
GET /api/sessions/550e8400-e29b-41d4-a716-446655440000/export
Authorization: Bearer {jwt_token}
```

**Example Response (200)**:
```json
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
  "exportedAt": "2026-02-10T15:00:00Z",
  "sessionMetadata": {
    "startedAt": "2026-02-10T10:30:00Z"
  },
  "answers": [
    {
      "answerId": "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6",
      "sessionId": "550e8400-e29b-41d4-a716-446655440000",
      "questionId": "annual_income",
      "answerValue": 45000,
      "dataType": "number"
    }
  ],
  "eligibilityResults": {}
}
```

---

## Security Scheme

**Type**: HTTP Bearer (JWT)

**Scheme**: `Bearer`

**Bearer Format**: JWT (JSON Web Token)

**Header**: `Authorization: Bearer {token}`

**Example JWT Payload**:
```json
{
  "sub": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
  "email": "user@example.com",
  "role": "Applicant",
  "iat": 1707573000,
  "exp": 1707659400
}
```

---

## Error Response Format

All error responses follow this standardized format:

```json
{
  "isValid": false,
  "code": "ERROR_CODE",
  "message": "Human-readable explanation of what went wrong",
  "errors": [
    {
      "field": "fieldName",
      "message": "Explanation and remediation guidance"
    }
  ]
}
```

**Common Error Codes**:
- `VALIDATION_ERROR`: Request validation failed
- `AUTHENTICATION_FAILED`: JWT token invalid or expired
- `AUTHORIZATION_DENIED`: User lacks permission to access resource  
- `NOT_FOUND`: Resource does not exist
- `INTERNAL_ERROR`: Unexpected server error

---

## Notes

- All timestamps are ISO 8601 format (UTC/Z)
- All UUIDs are in standard RFC 4122 format
- Content-Type for all responses is `application/json`
- Pagination defaults to 100 items; maximum 1000 per request
- Rate limiting: 1000 requests per minute (per user)
